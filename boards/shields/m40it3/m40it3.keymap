#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
#include <dt-bindings/zmk/input_transform.h>

/* 外部のキーマップ本体を読み込む */
#include "../../../config/keymap.keymap"

/ {
    /* スクロール変換プロセッサの定義 */
    zip_scroll_transform: zip_scroll_transform {
        compatible = "zmk,input-processor-transform";
        #input-processor-cells = <1>;
        type = <0x02>;           /* INPUT_EV_REL */
        /* 軸調整：センサーのYを垂直スクロール、Xを水平スクロールへ */
        x-codes = <0x01>, <0x08>; 
        y-codes = <0x00>, <0x06>;
    };

    /* 通常のXY移動プロセッサ */
    zip_xy_transform: zip_xy_transform {
        compatible = "zmk,input-processor-transform";
        #input-processor-cells = <1>;
        type = <0x02>;
        x-codes = <0x00>;
        y-codes = <0x01>;
    };

    /* リスナー本体をここに記述することでレイヤー判定を確実にさせる */
    trackball_listener: trackball_listener {
        compatible = "zmk,input-listener";
        device = <&trackball>;

        /* 通常時：XY入れ替えとX反転を適用 */
        input-processors = <&zip_xy_transform (INPUT_TRANSFORM_XY_SWAP | INPUT_TRANSFORM_X_INVERT)>;

        /* スクロール設定：レイヤー1の時 */
        scrolling {
            layers = <1>;
            input-processors = <&zip_scroll_transform 0>;
        };
    };
};
